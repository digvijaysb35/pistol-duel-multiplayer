<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pistol Duel</title>
<style>
body { margin:0; background:#222; overflow:hidden; }
canvas { display:block; margin:auto; border:6px solid #777; border-radius:14px; background:#000; }
#menu { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px; }
button { padding:12px 20px; font-size:18px; }
</style>
</head>
<body>

<div id="menu">
  <button onclick="create('zeroG')">Create Zero-G</button>
  <button onclick="create('moon')">Create Moon</button>
  <button onclick="create('heavy')">Create Heavy</button>
  <input id="room" placeholder="Room Code">
  <button onclick="join()">Join Room</button>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 420;
canvas.height = innerHeight - 20;

const ws = new WebSocket("wss://pistol-duel-multiplayer.onrender.com");

let state = null;

function create(map) {
  const room = Math.random().toString(36).slice(2,7);
  ws.send(JSON.stringify({ type:"create", room, map }));
  alert("Room Code: " + room);
  document.getElementById("menu").style.display = "none";
}

function join() {
  const room = document.getElementById("room").value;
  ws.send(JSON.stringify({ type:"join", room }));
  document.getElementById("menu").style.display = "none";
}

canvas.onclick = () => ws.send(JSON.stringify({ type:"shoot" }));

ws.onmessage = e => {
  const data = JSON.parse(e.data);
  if (data.type === "state") state = data.state;
};

function drawBG(bg) {
  ctx.fillStyle =
    bg === "space" ? "#000" :
    bg === "moon" ? "#222" : "#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function drawGun(g,c){
  ctx.save(); ctx.translate(g.x,g.y); ctx.rotate(g.angle);
  ctx.fillStyle=c; ctx.fillRect(-20,-8,40,16);
  ctx.restore();
}

function loop(){
  if (!state) return requestAnimationFrame(loop);
  drawBG(state.map.background);
  drawGun(state.players.blue,"#00aaff");
  drawGun(state.players.white,"#ff4444");
  state.bullets.forEach(b=>{
    ctx.fillStyle=b.owner==="blue"?"#00aaff":"#ff4444";
    ctx.beginPath(); ctx.arc(b.x,b.y,3,0,Math.PI*2); ctx.fill();
  });
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
